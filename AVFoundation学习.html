<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.5 (453172)"/><meta name="altitude" content="31.98109245300293"/><meta name="author" content="1209996080@qq.com"/><meta name="created" content="2017-01-11 01:58:36 +0000"/><meta name="latitude" content="30.25646433182942"/><meta name="longitude" content="120.2100474455291"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2017-01-19 09:31:54 +0000"/><title>AVFoundation学习</title></head><body>
<div>1、二维码扫描、生成、识别</div>
<div><span style="color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">AVFoundation是一个可以用来使用和创建基于时间的视听媒体的框架，它提供了一个能使用基于时间的视听数据的详细级别的Objective-C接口。例如：您可以用它来检查，创建，编辑或是重新编码媒体文件。也可以从设备中获取输入流，在视频实时播放时操作和回放。下图时AVFoundation在IOS中的架构。</span><img src="AVFoundation%E5%AD%A6%E4%B9%A0.resources/1170656-a760da97929514dd.png" height="320" width="565"/></div>
<div><br/></div>
<div>二维码扫描使用AVFoundation的<span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; font-family: Menlo; font-variant-ligatures: no-common-ligatures;"><span style="color: rgb(195, 89, 0);">AVCaptureSession，</span>使用起来也是比较简单的。</span></div>
<div><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; font-family: Menlo; font-variant-ligatures: no-common-ligatures;">看图理解苹果设计的理念：</span></div>
<div><img src="AVFoundation%E5%AD%A6%E4%B9%A0.resources/2428F3F5-EC3F-46B9-BAE1-D51F155C9BC6.png" height="550" width="1002"/></div>
<div>//声明会话</div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureSession </span> <span style="font-family: Menlo;">*</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">session</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">= [[</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureSession</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">alloc</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">]</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">init</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;"><span style="font-family: Menlo;">];</span></span></div>
<div><span style="font-family: Menlo;">//设置捕获质量高</span></div>
<div><span style="font-family: Menlo;"> [<span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">_session</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">setSessionPreset</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVCaptureSessionPresetHigh</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];</span></span></div>
<div><span style="font-family: Menlo;">//声明捕获设备</span></div>
<div><span style="font-family: Menlo;"><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureDevice</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*device = [</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureDevice</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">defaultDeviceWithMediaType</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMediaTypeVideo</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];</span></span></div>
<div><span style="font-family: Menlo;"><span style="color: rgb(195, 89, 0);">//声明</span></span><span style="font-family: Menlo;">捕获</span><span style="font-family: Menlo;"><span style="color: rgb(195, 89, 0);">设备输入</span></span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">NSError</span> <span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;"><span style="font-family: Menlo;">*error;</span></span></div>
<div><span style="font-family: Menlo;"><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureDeviceInput</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*input = [</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureDeviceInput</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">deviceInputWithDevice</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:device</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">error</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:&amp;error];</span></span></div>
<div><span style="font-family: Menlo;">//声明捕获设备</span><span style="font-family: Menlo;">数据</span><span style="font-family: Menlo;">输出</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureMetadataOutput</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*output = [[</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureMetadataOutput</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">alloc</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">]</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">init</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];</span></div>
<div><span style="font-family: Menlo;"><br/></span></div>
<div><span style="font-family: Menlo;">//会话添加捕获输入设备</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">if</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">([</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">_session</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">canAddInput</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;"><span style="font-family: Menlo;">:input]){</span></span></div>
<div><span style="font-family: Menlo;">            [<span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">_session</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">addInput</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;">:input];</span></span></div>
<div><span style="font-family: Menlo;">    }</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">if</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">([</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">_session</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">canAddOutput</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:output]){<br/>
            [</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">_session</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">addOutput</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;"><span style="font-family: Menlo;">:output];</span></span></div>
<div><span style="font-family: Menlo;">        }</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"> </span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">// 设置</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">条码类型</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">AVMetadataObjectTypeQRCode</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">       </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">if</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">(([output.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">availableMetadataObjectTypes</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">containsObject</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeQRCode</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">]) ||<br/>
            ([output.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">availableMetadataObjectTypes</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
             </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">containsObject</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeCode128Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">])){<br/>
            output.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">metadataObjectTypes</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">=</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">@[</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeQRCode</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,<br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeCode39Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,<br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeCode128Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,<br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeCode39Mod43Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,<br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeEAN13Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,<br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeEAN8Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,<br/>
                                         </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">AVMetadataObjectTypeCode93Code</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">]</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;"><span style="font-family: Menlo;">;</span></span></div>
<div><span style="font-family: Menlo;">        }</span></div>
<div><span style="font-family: Menlo;">//创建显示图层</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"> </span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureVideoPreviewLayer *</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">previewLayer</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">= [</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">AVCaptureVideoPreviewLayer</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">layerWithSession</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #1938b3">session</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];</span></div>
<div><a href="AVFoundation%E5%AD%A6%E4%B9%A0.resources/ScanDemo.zip">ScanDemo.zip</a></div>
<div><br/></div>
<div><br/></div>
<div>2、视频、音频的录制、播放</div>
<div>iOS系统视频录制有两种方式，简单的录制使用 <span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; font-family: Menlo; font-variant-ligatures: no-common-ligatures;"><span style="color: rgb(195, 89, 0);">UIImagePickerController</span> 就可以了，如果想要实现自定功能的录制就需要用AVFoundation了。下面是 </span> <span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; font-family: Menlo; font-variant-ligatures: no-common-ligatures;"><span style="color: rgb(195, 89, 0);">UIImagePickerController</span> 使用。</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">  </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/></span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #062aba">#pragma mark -</span> <span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #062aba">弹出视频录制控制器</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #062aba"><br/></span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">- (</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">void</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">)useImagePickerController {<br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">声明</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">UIImagePickerController</span> <span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">对象</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">UIImagePickerController</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*picker = [[</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">UIImagePickerController</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">alloc</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">]</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">init</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];<br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">使用摄像头</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
    picker.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">sourceType</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">=</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #273abc">UIImagePickerControllerSourceTypeCamera</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">;<br/>
    {<br/>
       </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">这个两个属性要一起用</span> <span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">并导入头问题</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">#import &lt;MobileCoreServices/MobileCoreServices.h&gt;</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
        picker.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">mediaTypes</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">=</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">@[</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">(</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">id</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">)</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">kUTTypeMovie</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">]</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">;<br/>
        picker.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">cameraCaptureMode</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">=</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #273abc">UIImagePickerControllerCameraCaptureModeVideo</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">;<br/>
    }<br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">使用后置摄像头</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
    picker.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">cameraDevice</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">=</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #273abc">UIImagePickerControllerCameraDeviceRear</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">;<br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">设置代理</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
    picker.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">delegate</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">=</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">self</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">;<br/>
    [</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">self</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">presentViewController</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:picker</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">animated</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">YES</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">completion</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">nil</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];</span></div>
<div><span style="font-family: Menlo;">}</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #062aba">#pragma mark - UIImagePickerControllerDelegate<br/></span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">- (</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">void</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary&lt;NSString *,</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">id</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">&gt; *)info {<br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">保存录制视频信息</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures"><br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//1</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">、获得视频路径</span></div>
<div><span style="font-family: Menlo;">    <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">NSURL</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*videoURL = info[</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">UIImagePickerControllerMediaURL</span>];</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #cf8724">//2</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #cf8724">、保存</span></div>
<div><span style="font-family: Menlo;">    <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">UISaveVideoAtPathToSavedPhotosAlbum</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">(</span></span><span style="font-family: Menlo;"><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">videoURL</span></span><span style="font-family: Menlo;"><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">.</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #708ba8">absoluteString</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">self</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">,</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">@selector</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">(video:didFinishSavingWithError:contextInfo:),</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">nil</span>);</span></div>
<div><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">    [picker</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">dismissViewControllerAnimated</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">YES</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">completion</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">:</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">nil</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">];<br/>
}<br/>
-(</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">void</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">)video:(</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">NSString</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*)videoPath didFinishSavingWithError:(</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #c35900">NSError</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*)error contextInfo:(</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #35568a">void</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">*)contextInfo{<br/>
   </span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #5f76a8">NSLog</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures">(</span><span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #e82300">@"</span><span style="font: 14.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #e82300">保存</span> <span style="font: 14.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #e82300">complete"</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-variant-ligatures: no-common-ligatures;"><span style="font-family: Menlo;">);</span></span></div>
<div><span style="font-family: Menlo;">}</span></div>
<div><span style="font-family: Menlo;">基于AVFoundation我也模拟系统录制写了一个demo，由于时间原因，一些细节就没有处理。现在先看一下</span><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; font-size: 14px; font-family: Menlo; font-variant-ligatures: no-common-ligatures;"><span style="color: rgb(195, 89, 0);">AVCaptureSession</span>的工作流程。</span></div>
<div><img src="AVFoundation%E5%AD%A6%E4%B9%A0.resources/2428F3F5-EC3F-46B9-BAE1-D51F155C9BC6.png" height="550" width="1002"/></div>
<div><br/></div>
<div><br/></div>
</body></html>